<v:ExtendedUserControl x:Class="OneDo.View.Controls.ModalContainer"
                       xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                       xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                       xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                       xmlns:behaviors="using:OneDo.View.Behaviors"
                       xmlns:controls="using:OneDo.View.Controls"
                       xmlns:converters="using:OneDo.View.Converters"
                       xmlns:entities="using:OneDo.Model.Data.Entities"
                       xmlns:i="using:Microsoft.Xaml.Interactivity"
                       xmlns:ic="using:Microsoft.Xaml.Interactions.Core"
                       xmlns:im="using:Microsoft.Xaml.Interactions.Media"
                       xmlns:v="using:OneDo.View"
                       xmlns:vModals="using:OneDo.View.Modals"
                       xmlns:vmItems="using:OneDo.ViewModel.Items"
                       xmlns:vmModals="using:OneDo.ViewModel.Modals"
                       DataContext="{Binding ModalService, Source={StaticResource Locator}}"
                       mc:Ignorable="d">

    <Grid Grid.RowSpan="3">
        <Grid>
            <Border x:Name="RootBorder"
                    Opacity="0"
                    Visibility="Collapsed">
                <Border.Background>
                    <SolidColorBrush Color="{ThemeResource SystemChromeBlackMediumLowColor}" />
                </Border.Background>
                <i:Interaction.Behaviors>
                    <ic:EventTriggerBehavior EventName="Tapped">
                        <ic:InvokeCommandAction Command="{x:Bind VM.CloseCurrentCommand}" />
                    </ic:EventTriggerBehavior>
                    <ic:DataTriggerBehavior Binding="{x:Bind VM.Items.Count, Mode=OneWay}"
                                            ComparisonCondition="Equal"
                                            Value="0">
                        <im:ControlStoryboardAction>
                            <im:ControlStoryboardAction.Storyboard>
                                <Storyboard>
                                    <DoubleAnimation BeginTime="0:0:0.3"
                                                     Duration="0:0:0.3"
                                                     Storyboard.TargetName="RootBorder"
                                                     Storyboard.TargetProperty="Opacity"
                                                     To="0" />
                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootBorder" Storyboard.TargetProperty="Visibility">
                                        <DiscreteObjectKeyFrame KeyTime="0:0:0.6" Value="Collapsed" />
                                    </ObjectAnimationUsingKeyFrames>
                                </Storyboard>
                            </im:ControlStoryboardAction.Storyboard>
                        </im:ControlStoryboardAction>
                    </ic:DataTriggerBehavior>
                    <ic:DataTriggerBehavior Binding="{x:Bind VM.Items.Count, Mode=OneWay}"
                                            ComparisonCondition="GreaterThan"
                                            Value="0">
                        <im:ControlStoryboardAction>
                            <im:ControlStoryboardAction.Storyboard>
                                <Storyboard>
                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootBorder" Storyboard.TargetProperty="Visibility">
                                        <DiscreteObjectKeyFrame KeyTime="0" Value="Visible" />
                                    </ObjectAnimationUsingKeyFrames>
                                    <DoubleAnimation Duration="0:0:0.3"
                                                     Storyboard.TargetName="RootBorder"
                                                     Storyboard.TargetProperty="Opacity"
                                                     To="1" />
                                </Storyboard>
                            </im:ControlStoryboardAction.Storyboard>
                        </im:ControlStoryboardAction>
                    </ic:DataTriggerBehavior>
                </i:Interaction.Behaviors>
            </Border>
            <ItemsControl HorizontalContentAlignment="Stretch"
                          VerticalContentAlignment="Stretch"
                          ItemsSource="{x:Bind VM.Items, Mode=OneWay}">
                <ItemsControl.ItemContainerTransitions>
                    <TransitionCollection>
                        <AddDeleteThemeTransition />
                        <!--<EntranceThemeTransition IsStaggeringEnabled="True" />-->
                    </TransitionCollection>
                </ItemsControl.ItemContainerTransitions>
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Grid />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplateSelector>
                    <v:ModalTemplateSelector>
                        <v:ModalTemplateSelector.FolderEditorTemplate>
                            <DataTemplate x:DataType="vmModals:FolderEditorViewModel">
                                <vModals:FolderEditor x:Name="Root"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Top" />
                            </DataTemplate>
                        </v:ModalTemplateSelector.FolderEditorTemplate>
                        <v:ModalTemplateSelector.NoteEditorTemplate>
                            <DataTemplate x:DataType="vmModals:NoteEditorViewModel">
                                <vModals:NoteEditor Margin="16" />
                            </DataTemplate>
                        </v:ModalTemplateSelector.NoteEditorTemplate>
                        <v:ModalTemplateSelector.SettingsTemplate>
                            <DataTemplate x:DataType="vmModals:SettingsViewModel">
                                <vModals:SettingsView Width="400" HorizontalAlignment="Right" />
                            </DataTemplate>
                        </v:ModalTemplateSelector.SettingsTemplate>
                    </v:ModalTemplateSelector>
                </ItemsControl.ItemTemplateSelector>
            </ItemsControl>
        </Grid>
    </Grid>

</v:ExtendedUserControl>
